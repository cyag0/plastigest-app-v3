# PlastiGest - Instrucciones para GitHub Copilot

## üèóÔ∏è Arquitectura de la Aplicaci√≥n

### Estructura Principal
- **Frontend**: React Native con Expo Router
- **Backend**: Laravel con API REST
- **Autenticaci√≥n**: Sistema multi-tenant por compa√±√≠a
- **Navegaci√≥n**: Expo Router con tabs y stacks
- **Componentes**: Sistema de componentes reutilizables

---

## üìÅ Estructura de Carpetas

### `/app/(tabs)/home/` - M√≥dulos CRUD
Cada m√≥dulo sigue esta estructura est√°ndar:
```
module-name/
‚îú‚îÄ‚îÄ _layout.tsx      # AppBar con navegaci√≥n
‚îú‚îÄ‚îÄ index.tsx        # Lista principal (usa AppList)
‚îú‚îÄ‚îÄ form.tsx         # Formulario CRUD (usa AppForm)
‚îî‚îÄ‚îÄ [id].tsx         # Vista/edici√≥n por ID
```

### `/components/` - Componentes Reutilizables
**SIEMPRE usa componentes de esta carpeta**:
- `Form/AppForm/` - Formularios controlados
- `Form/AppInput.tsx` - Input de texto
- `Form/AppSelect/` - Selectores 
- `Form/AppDatePicker.tsx` - Selector de fechas
- `Form/AppCheckBox.tsx` - Checkbox
- `App/AppList/` - Listas con paginaci√≥n
- `App/AppBar/` - Barra de navegaci√≥n

### `/utils/services/` - Servicios API
Organizado por m√≥dulos:
```
services/
‚îú‚îÄ‚îÄ index.ts              # Registro central de servicios
‚îú‚îÄ‚îÄ admin/               # Administraci√≥n (users, roles, companies)
‚îú‚îÄ‚îÄ catalogos/          # Cat√°logos (productos, categor√≠as, unidades)
‚îú‚îÄ‚îÄ inventories/        # Inventarios y movimientos
‚îî‚îÄ‚îÄ operations/         # Compras, ventas, transferencias
```

---

## üéØ Patrones de Desarrollo

### 1. **Creaci√≥n de Nuevos M√≥dulos**

#### Paso 1: Actualizar Enlaces en Dashboard
Ubicaci√≥n: `/app/(tabs)/home/index.tsx`

Para **movimientos** (compras, ventas, transferencias):
```tsx
movimientos: ResourceProps[] = [
  {
    key: "nuevo-modulo",
    label: "Nuevo M√≥dulo",
    description: "Descripci√≥n del m√≥dulo",
    link: "/(tabs)/home/nuevo-modulo", // ‚Üê Agregar ruta correcta
    // ... resto de propiedades
  }
]
```

Para **cat√°logos** (productos, categor√≠as, etc.):
```tsx
catalogos: ResourceProps[] = [
  {
    key: "nuevo-catalogo", 
    label: "Nuevo Cat√°logo",
    description: "Descripci√≥n del cat√°logo",
    link: "/(tabs)/home/nuevo-catalogo", // ‚Üê Agregar ruta correcta
    // ... resto de propiedades
  }
]
```

#### Paso 2: Crear Carpeta del M√≥dulo
`/app/(tabs)/home/nuevo-modulo/`

#### Paso 3: Implementar Archivos Est√°ndar

##### `_layout.tsx` - Siempre incluir AppBar
```tsx
import { AppBar } from "@/components/App/AppBar";
import { Stack } from "expo-router";

export default function ModuleLayout() {
  return (
    <>
      <AppBar title="Nombre del M√≥dulo" showBackButton />
      <Stack screenOptions={{ headerShown: false }}>
        <Stack.Screen name="index" />
        <Stack.Screen name="form" />
        <Stack.Screen name="[id]" />
      </Stack>
    </>
  );
}
```

##### `index.tsx` - Usar AppList SIEMPRE
```tsx
import { AppList } from "@/components/App/AppList/AppList";
import Services from "@/utils/services";

export default function ModuleIndex() {
  return (
    <AppList
      service={Services.admin.nombreModulo} // ‚Üê Usar servicio correspondiente
      title="Lista de Items"
      searchPlaceholder="Buscar..."
      usePagination={true}
    />
  );
}
```

##### `form.tsx` - Usar AppForm y componentes Form/
```tsx
import { AppForm } from "@/components/Form/AppForm/AppForm";
import { AppInput } from "@/components/Form/AppInput";
import { AppSelect } from "@/components/Form/AppSelect/AppSelect";
import Services from "@/utils/services";
import * as Yup from "yup";

interface FormData {
  name: string;
  description?: string;
  // ... otros campos
}

const validationSchema = Yup.object().shape({
  name: Yup.string().required("Nombre es requerido"),
  // ... otras validaciones
});

export default function ModuleForm() {
  return (
    <AppForm<FormData>
      service={Services.admin.nombreModulo}
      validationSchema={validationSchema}
      initialValues={{
        name: "",
        description: "",
      }}
    >
      <AppInput name="name" label="Nombre" />
      <AppInput name="description" label="Descripci√≥n" multiline />
      {/* Usar m√°s componentes de Form/ seg√∫n necesidad */}
    </AppForm>
  );
}
```

##### `[id].tsx` - Reutilizar form.tsx con prop id
```tsx
import { useLocalSearchParams } from "expo-router";
import ModuleForm from "./form";

export default function ModuleDetail() {
  const { id } = useLocalSearchParams();
  
  return <ModuleForm id={id as string} />;
}
```

### 2. **Servicios API**

#### Registrar Servicio en `/utils/services/index.ts`
```tsx
import admin from "./admin/admin";
import catalogos from "./catalogos/catalogos"; // ‚Üê Nuevo
import inventories from "./inventories/inventories"; // ‚Üê Nuevo

const Services = {
  admin,
  catalogos,    // ‚Üê Registrar
  inventories,  // ‚Üê Registrar
};

export default Services;
```

#### Crear Servicio Espec√≠fico
Ejemplo: `/utils/services/catalogos/productos/index.ts`
```tsx
import { CrudService } from "../../crudService";

export interface Product {
  id?: number;
  name: string;
  description?: string;
  company_id?: number;
}

export const productService = new CrudService<Product>({
  baseURL: "/admin/products", // ‚Üê Ruta del backend
  resource: "productos"
});

export default productService;
```

#### Registrar en M√≥dulo Principal
`/utils/services/catalogos/catalogos.ts`
```tsx
import productService from "./productos";
import categoryService from "./categorias";

const catalogos = {
  productos: productService,
  categorias: categoryService,
};

export default catalogos;
```

---

## üîß Componentes Obligatorios

### AppForm - Formularios Controlados
**SIEMPRE usar para formularios**
```tsx
<AppForm<DataType>
  service={serviceInstance}
  validationSchema={yupSchema}
  initialValues={defaultValues}
  id={editId} // Para edici√≥n
>
  {/* Componentes de Form/ */}
</AppForm>
```

### AppList - Listas con Paginaci√≥n
**SIEMPRE usar para listados**
```tsx
<AppList
  service={serviceInstance}
  title="T√≠tulo de la Lista"
  searchPlaceholder="Buscar..."
  usePagination={true}
  itemsPerPage={10}
/>
```

### Componentes Form/ - Inputs Controlados
```tsx
<AppInput name="fieldName" label="Label" />
<AppSelect name="fieldName" label="Label" options={options} />
<AppDatePicker name="fieldName" label="Label" />
<AppCheckBox name="fieldName" label="Label" />
```

### AppBar - Navegaci√≥n
```tsx
<AppBar 
  title="T√≠tulo"
  showBackButton={true}
  actions={[/* botones adicionales */]}
/>
```

---

## üé® Estilos y Colores

### Usar palette.ts SIEMPRE
```tsx
import palette from "@/constants/palette";

const styles = StyleSheet.create({
  container: {
    backgroundColor: palette.background,
  },
  text: {
    color: palette.text,
  },
});
```

---

## üîÑ Flujo de Desarrollo CRUD

### 1. **Planificar el M√≥dulo**
- Identificar si es movimiento o cat√°logo
- Definir campos del modelo
- Crear interfaz TypeScript

### 2. **Backend (Laravel)**
- Crear migraci√≥n
- Crear modelo con relaciones
- Crear controller extendiendo CrudController
- Crear resource para transformaci√≥n
- Registrar rutas en api.php

### 3. **Frontend (React Native)**
- Agregar link en dashboard (`index.tsx`)
- Crear carpeta del m√≥dulo
- Implementar `_layout.tsx` con AppBar
- Implementar `index.tsx` con AppList
- Implementar `form.tsx` con AppForm
- Implementar `[id].tsx` reutilizando form
- Crear servicio en utils/services
- Registrar servicio en index.ts

### 4. **Validaci√≥n y Testing**
- Probar CRUD completo
- Verificar navegaci√≥n
- Validar formularios
- Confirmar paginaci√≥n

---

## üìã Checklist de Nuevos M√≥dulos

- [ ] ‚úÖ Link agregado en dashboard
- [ ] ‚úÖ Carpeta creada en `/app/(tabs)/home/`
- [ ] ‚úÖ `_layout.tsx` con AppBar
- [ ] ‚úÖ `index.tsx` con AppList
- [ ] ‚úÖ `form.tsx` con AppForm y componentes Form/
- [ ] ‚úÖ `[id].tsx` reutilizando form
- [ ] ‚úÖ Servicio creado en utils/services
- [ ] ‚úÖ Servicio registrado en index.ts
- [ ] ‚úÖ Interfaz TypeScript definida
- [ ] ‚úÖ Validaci√≥n Yup implementada
- [ ] ‚úÖ Navegaci√≥n funcionando
- [ ] ‚úÖ CRUD completo operativo

---

## üö® Reglas Importantes

1. **NUNCA crear componentes desde cero** - Usar componentes existentes
2. **SIEMPRE usar AppForm** para formularios
3. **SIEMPRE usar AppList** para listados  
4. **SIEMPRE incluir AppBar** en layouts
5. **SIEMPRE registrar servicios** en index.ts
6. **SIEMPRE usar palette.ts** para colores
7. **SIEMPRE seguir la estructura** de carpetas establecida
8. **SIEMPRE usar TypeScript** con interfaces definidas
9. **SIEMPRE usar Yup** para validaciones
10. **SIEMPRE probar** el CRUD completo antes de finalizar

---

## üí° Ejemplos de Referencia

### M√≥dulo M√°s Completo: `locations/`
- Revisar para patrones de implementaci√≥n
- Usar como template para nuevos m√≥dulos
- Seguir la misma estructura y componentes

### Servicios Existentes: `admin/`
- Estructura de servicios
- Patrones de CrudService
- Registro en index.ts

Esta documentaci√≥n garantiza consistencia y calidad en todos los m√≥dulos del sistema PlastiGest.